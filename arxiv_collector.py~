#! /usr/bin/env python
from PySide import QtGui, QtCore
import sys, re
import requests
from bs4 import BeautifulSoup as BS

class ArxivCollector(QtGui.QMainWindow):
    def __init__(self):
        """
        intitialize
        """
        super(ArxivCollector, self).__init__()
        self.links = []
        self.titles = []
        self.abs_contents = []
        self.n_abs = []
        self.CreateMainWindow()


    def CreateMainWindow(self):
        self.Main_Window = QtGui.QWidget()
        # self.list = QtGui.QListView(self.Main_Window)
        # self.model = QtGui.QStandardItemModel(self.list)
        self.list = QtGui.QListWidget(self.Main_Window)
        self.list.itemDoubleClicked[QtGui.QListWidgetItem].connect(self.test)
        self.list.setMinimumHeight(500)
        self.list.setFixedWidth(400)
        self.refresh_btn = QtGui.QPushButton("Refresh", self.Main_Window)
        self.refresh_btn.setMaximumSize(QtCore.QSize(72, 36))
        self.refresh_btn.pressed.connect(self.refresh)
        vbox = QtGui.QVBoxLayout()
        vbox.addWidget(self.list)
        vbox.addWidget(self.refresh_btn)

        self.Main_Window.setLayout(vbox)
        self.setCentralWidget(self.Main_Window)

    def test(self, item):
        print item.text()

    def refresh(self):
        self.CollectAbs()
        self.list.clear()
        for title in self.titles:
            # item = QtGui.QStandardItem(title)
            # self.model.appendRow(item)
            self.list.addItem(QtGui.QListWidgetItem(title))
        # self.list.setModel(self.model) 

    def CollectAbs(self):
        url = 'http://arxiv.org/list/astro-ph/new'
        try:
            body = BS(requests.get(url, timeout = 15).text).body
            self.links = map(lambda html:'http://arxiv.org/' + html.contents[2].a.attrs['href'], body.findAll('dt'))
            self.titles = map(lambda html: html.div.div.text.strip(), body.findAll('dd'))
            self.abs_contents = map(lambda html: html.div.p, body.findAll('dd'))
            self.n_abs = len(self.titles)

        except (requests.exceptions.ConnectionError, requests.exceptions.MissingSchema) as e:
            pass
            
if __name__ == '__main__':
    app = QtGui.QApplication(sys.argv)
    form = ArxivCollector()
    form.CollectAbs()

    # form.show()
    # sys.exit(app.exec_())
